<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="translations.js"></script>
<title>DDON Account Panel</title>

<style>
body{
    margin:0;
    background:#0b0c14;
    color:#e6e6e6;
    font-family:'Cinzel', serif;
}

/* HEADER */

.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:20px 60px;
    border-bottom:1px solid #1f1f2a;
}

.header h1{
    margin:0;
    font-size:28px;
    letter-spacing:2px;
}

/* LANGUAGE */

#languageSelector{
    display:flex;
    gap:6px;
}

.langBtn{
    background:#151622;
    border:1px solid #c8a75d;
    color:#c8a75d;
    padding:6px 10px;
    cursor:pointer;
    font-size:12px;
    transition:0.2s;
}

.langBtn:hover{
    background:#c8a75d;
    color:black;
}

/* LAYOUT */

.container{
    display:flex;
    padding:40px 80px;
    gap:40px;
}

/* SIDEBAR */

.sidebar{
    width:220px;
}

.sidebar button{
    width:100%;
    margin-bottom:15px;
}

/* MAIN */

.main{
    flex:1;
}

/* CARDS */

.card{
    background:linear-gradient(145deg,#171827,#10111a);
    padding:30px;
    border:1px solid #222334;
    box-shadow:0 0 25px rgba(0,0,0,0.6);
    margin-bottom:30px;
}

/* CHARACTER GRID */

.charactersGrid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:25px;
}

/* CHARACTER CARD */

.characterCard{
    background:#141523;
    border:1px solid #2a2c40;
    padding:20px;
    transition:0.3s;
}

.characterCard:hover{
    transform:translateY(-4px);
    box-shadow:0 0 15px rgba(200,167,93,0.3);
}

.badge{
    display:inline-block;
    padding:5px 10px;
    margin-top:10px;
    border:1px solid #c8a75d;
    font-size:12px;
    color:#c8a75d;
}

/* BUTTON */

button{
    background:#c8a75d;
    border:none;
    padding:8px 14px;
    cursor:pointer;
    font-weight:bold;
}

button:hover{
    opacity:0.9;
}

</style>
</head>

<body>

<div class="header">
    <h1 data-key="accountPanelTitle"></h1>
    <div id="languageSelector"></div>
</div>

<div class="container">

    <div class="sidebar">
        <button data-key="changePassword" onclick="openChangePassword()"></button>
        <button data-key="logout" onclick="logout()"></button>
    </div>

    <div class="main">

        <div class="card">
            <h2 data-key="dashboardTitle"></h2>
        </div>

        <h2 data-key="charactersTitle"></h2>
        <div id="characters" class="charactersGrid"></div>

    </div>

</div>

<!-- Change Password Modal -->
<div id="passwordModal" style="display:none;" class="card">

    <h3 data-key="changePassword"></h3>

    <input id="currentPass" type="password" data-placeholder="currentPassword">
    <input id="newPass" type="password" data-placeholder="newPassword">
    <input id="confirmPass" type="password" data-placeholder="confirmPassword">

    <p id="pwMsg"></p>

    <button data-key="save" onclick="changePassword()"></button>
    <button data-key="cancel" onclick="closeChangePassword()"></button>

</div>

<script>

const jobMap = {
    1: "Fighter",
    2: "Seeker",
    3: "Hunter",
    4: "Priest",
    5: "Shield Sage",
    6: "Sorcerer",
    7: "Warrior",
    8: "Element Archer",
    9: "Alchemist",
    10: "Spirit Lancer",
    11: "High Scepter"
};

async function login(){
    try{
        const res = await fetch("https://api.ddon.org/api/login",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
                username:username.value,
                password:password.value
            })
        });

        if(!res.ok){
            const lang = localStorage.getItem("lang") || "en";
const t = translations[lang];

loginMsg.textContent = t.connectionError || "Connection error.";
            return;
        }

        const data = await res.json();

        if(data.token){
            localStorage.setItem("token",data.token);
            loginBox.style.display="none";
            dashboard.style.display="block";
            loadCharacters();
        } else {
            const lang = localStorage.getItem("lang") || "en";
const t = translations[lang];

loginMsg.textContent = t.loginFailed || "Login failed.";
        }

    }catch(e){
        const lang = localStorage.getItem("lang") || "en";
const t = translations[lang];

loginMsg.textContent = t.loginServerUnavailable || "Login server unavailable.";
    }
}

async function loadCharacters(){

    const lang = localStorage.getItem("lang") || "en";
    const t = translations[lang];

    try{
        const res = await fetch("https://api.ddon.org/api/characters",{
            headers:{
                "Authorization":"Bearer "+localStorage.getItem("token")
            }
        });

        if(!res.ok){
            characters.innerHTML = `<p>${t.charactersLoadError || "Could not load characters."}</p>`;
            return;
        }

        const chars = await res.json();
        characters.innerHTML="";

        if(!chars.length){
            characters.innerHTML = `<p>${t.noCharacters || "No characters found."}</p>`;
            return;
        }

        chars.forEach(c => {

            const jobName = jobMap[c.job] || c.job;
            const translatedJob =
                translations[lang]?.jobs?.[jobName] || jobName;

characters.innerHTML += `
    <div class="characterCard">
        <h3>${c.first_name} ${c.last_name}</h3>
        <p>${t.level}: ${c.lv}</p>
        <span class="badge">${translatedJob}</span>
    </div>
`;
            `;
        });

    }catch(e){
        characters.innerHTML = `<p>${t.characterApiError || "Character API error."}</p>`;
    }
}

async function loadStatus(){
    try{
        const res = await fetch("https://api.ddon.org/api/account-status",{
            headers:{
                "Authorization":"Bearer "+localStorage.getItem("token")
            }
        });

        if(!res.ok){
            onlineStatus.innerHTML = `<span class="offline">ðŸ”´ Status unavailable</span>`;
            return;
        }

        const data = await res.json();

        if(data.online){
            onlineStatus.innerHTML = `<span class="online">ðŸŸ¢ Online</span>`;
        }else{
            onlineStatus.innerHTML = `<span class="offline">ðŸ”´ Offline</span>`;
        }

    }catch(e){
        onlineStatus.innerHTML = `<span class="offline">ðŸ”´ API Error</span>`;
    }
}

function logout(){
    localStorage.removeItem("token");
    location.reload();
}

function applyTranslations(){
    const lang = localStorage.getItem("lang") || "en";
    const t = translations[lang];

    document.querySelectorAll("[data-key]").forEach(el=>{
        const key = el.getAttribute("data-key");
        if(t[key]) el.textContent = t[key];
    });

    document.querySelectorAll("[data-placeholder]").forEach(el=>{
        const key = el.getAttribute("data-placeholder");
        if(t[key]) el.placeholder = t[key];
    });
}

/* PASSWORD */

function openChangePassword(){
    passwordModal.style.display="block";
}

function closeChangePassword(){
    passwordModal.style.display="none";
}

async function changePassword(){

    if(newPass.value !== confirmPass.value){
        const lang = localStorage.getItem("lang") || "en";
const t = translations[lang];

pwMsg.textContent = t.passwordsDontMatch || "Passwords do not match.";
        return;
    }

    const res = await fetch("https://api.ddon.org/api/change-password",{
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+localStorage.getItem("token")
        },
        body:JSON.stringify({
            current:currentPass.value,
            new:newPass.value
        })
    });

    const data = await res.json();
    const lang = localStorage.getItem("lang") || "en";
const t = translations[lang];

pwMsg.textContent =
    data.message ||
    data.error ||
    t.unknownError ||
    "Unknown error.";
}

function initLanguageSelector(){

    const container = document.getElementById("languageSelector");
    container.innerHTML = "";

    const currentLang = localStorage.getItem("lang") || "en";

    window.languages.forEach(lang=>{
        const btn = document.createElement("button");
        btn.className = "langBtn";
        btn.innerText = lang.flag + " " + lang.code.toUpperCase();

        if(lang.code === currentLang){
            btn.style.background = "#c8a75d";
            btn.style.color = "black";
        }

        btn.onclick = ()=>{
            localStorage.setItem("lang", lang.code);
            location.reload();
        };

        container.appendChild(btn);
    });
}

window.onload = function(){

    initLanguageSelector();
    applyTranslations();

    const token = localStorage.getItem("token");

    if(token){
        loginBox.style.display="none";
        dashboard.style.display="block";
        loadCharacters();
    }
};

</script>

</body>
</html>