<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DDON – Item Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="js/theme.js" defer></script>  
</head>
<body>

<h1>Item Search</h1>

<input
  id="search"
  type="text"
  placeholder="Search monster name or ID…"
  style="width:300px;padding:8px;font-size:16px"
>

<ul id="results"></ul>

<script type="module">
import { parseDDON } from "./js/ddon-parser.js";
import { groupByEnemy } from "./js/monster-utils.js";
import { loadEnemyNames } from "./js/enemy-names.js";

Promise.all([
  fetch("data/EnemySpawn.json").then(r => r.json()),
  loadEnemyNames()
]).then(([enemyData, enemyNames]) => {

  const { enemies } = parseDDON(enemyData);
  const monsters = groupByEnemy(enemies);

  const list = monsters.map(m => {
    const id = String(m.id);
    const name = enemyNames[id] || `Enemy ${id}`;
    return { id, name };
  });

  const resultsEl = document.getElementById("results");

  function render(filter = "") {
    resultsEl.innerHTML = "";

    const q = filter.toLowerCase();

    list
      .filter(m =>
        m.name.toLowerCase().includes(q) ||
        m.id.toLowerCase().includes(q)
      )
      .sort((a, b) => a.name.localeCompare(b.name))
      .forEach(m => {
        const li = document.createElement("li");
        li.innerHTML = `
          <a href="item.html?id=${m.id}">
            ${m.name} <small>(${m.id})</small>
          </a>
        `;
        resultsEl.appendChild(li);
      });
  }

  render();

  document.getElementById("search")
    .addEventListener("input", e => render(e.target.value));
});
</script>

</body>
</html>
