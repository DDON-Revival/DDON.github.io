<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DDON – Monster</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">

  <!-- optional: Theme / Sidebar JS -->
  <script src="js/theme.js" defer></script>
</head>

<body>

<!-- ===== SIDEBAR ===== -->
<nav class="sidebar">
  <h2>DDON Wiki</h2>

  <ul>
    <li><a href="index.html">Home</a></li>
  </ul>

  <h3>Search</h3>
  <ul>
    <li><a href="monsters.html">Monster</a></li>
    <li><a href="drops.html">Items</a></li>
    <li><a href="stages.html">Stages</a></li>
  </ul>

  <h3>Language</h3>
  <ul>
    <li><a href="#" onclick="setLang('en')">EN</a></li>
    <li><a href="#" onclick="setLang('jp')">JP</a></li>
  </ul>
</nav>

<!-- ===== MAIN CONTENT ===== -->
<main>
  <div id="content">Loading…</div>
</main>

<h1>Drop Search</h1>
<p>Search by Item ID (e.g. <code>19508</code>)</p>

<input
  id="search"
  type="text"
  placeholder="Enter Item ID"
  style="width:300px;padding:0.5rem;font-size:1rem"
>

<div id="results" style="margin-top:1rem"></div>

<script type="module">
/* ===== IMPORTS ===== */
import { parseDDON } from "./js/ddon-parser.js";
import { groupByEnemy } from "./js/monster-utils.js";
import { buildDropIndex } from "./js/drop-utils.js";
import { loadItemNames } from "./js/item-names.js";

/* ===== LOAD DATA ===== */
Promise.all([
  fetch("data/EnemySpawn.json").then(r => r.json()),
  loadItemNames()
]).then(([enemyData, itemNames]) => {

  /* Parse & group enemies */
  const { enemies } = parseDDON(enemyData);
  const monsters = groupByEnemy(enemies);

  /* Build drop index */
  const dropIndex = buildDropIndex(monsters);

  console.log("DropIndex keys:", Object.keys(dropIndex).slice(0, 20));

  /* ===== SEARCH HANDLER ===== */
  document.getElementById("search").addEventListener("input", e => {
    const itemId = e.target.value.trim();
    const resultsEl = document.getElementById("results");

    if (!itemId) {
      resultsEl.innerHTML = "";
      return;
    }

    const monsterList = dropIndex[itemId] || [];
    const itemName = itemNames[itemId]?.en || `Item ${itemId}`;

    if (!monsterList.length) {
      resultsEl.innerHTML = `
        <h3>${itemName}</h3>
        <p>No monsters drop this item.</p>
      `;
      return;
    }

    resultsEl.innerHTML = `
      <h3>${itemName}</h3>
      <ul>
		${monsterList.map(id =>
		`<li>Enemy ${id}</li>`
		).join("")}
      </ul>
    `;
  });
});
</script>

</body>
</html>
