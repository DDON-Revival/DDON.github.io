<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DDON</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="content">Loadingâ€¦</div>

<script type="module">
import { parseDDON } from "./js/ddon-parser.js";
import { loadStageNames } from "./js/stage-names.js";
import { loadEnemyNames } from "./js/enemy-names.js";

const stageId = new URLSearchParams(location.search).get("id");

Promise.all([
  fetch("data/EnemySpawn.json").then(r => r.json()),
  loadStageNames(),
  loadEnemyNames()
]).then(([enemyData, stageNames, enemyNames]) => {

  const { enemies } = parseDDON(enemyData);

  const spawns = enemies.filter(e =>
    String(e.StageId) === String(stageId)
  );

  if (!spawns.length) {
    document.getElementById("content").innerHTML =
      `<h1>Stage not found</h1>`;
    return;
  }

  const stage = stageNames[stageId];
  const stageName = stage?.en || `Stage ${stageId}`;
  const stageJP = stage?.jp || "";

  const enemiesInStage = {};
  spawns.forEach(e => {
    enemiesInStage[e.EnemyId] = true;
  });

  document.getElementById("content").innerHTML = `
    <h1>${stageName}</h1>
    <p>${stageJP}</p>
    <p><b>Stage ID:</b> ${stageId}</p>

    <h2>Enemies</h2>
    <ul>
      ${Object.keys(enemiesInStage).map(id => `
        <li>
          <a href="monster.html?id=${id}">
            ${enemyNames[id] || `Enemy ${id}`}
          </a>
        </li>
      `).join("")}
    </ul>
  `;
});
<script>
fetch("partials/sidebar.html")
  .then(r => r.text())
  .then(html => document.getElementById("sidebar").innerHTML = html);
</script>

</body>
</html>