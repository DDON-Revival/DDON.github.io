<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DDON – Monster</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">

  <!-- optional: Theme / Sidebar JS -->
  <script src="js/theme.js" defer></script>
</head>

<body>

<!-- ===== SIDEBAR ===== -->
<nav class="sidebar">
  <h2>DDON Wiki</h2>

  <ul>
    <li><a href="index.html">Home</a></li>
  </ul>

  <h3>Search</h3>
  <ul>
    <li><a href="monsters.html">Monster</a></li>
    <li><a href="drops.html">Items</a></li>
    <li><a href="stages.html">Stages</a></li>
  </ul>

  <h3>Language</h3>
  <ul>
    <li><a href="#" onclick="setLang('en')">EN</a></li>
    <li><a href="#" onclick="setLang('jp')">JP</a></li>
  </ul>
</nav>

<!-- ===== MAIN CONTENT ===== -->
<main>
  <div id="content">Loading…</div>
</main>

<script type="module">
import { parseDDON } from "./js/ddon-parser.js";
import { loadStageNames } from "./js/stage-names.js";
import { loadEnemyNames } from "./js/enemy-names.js";

const stageId = new URLSearchParams(location.search).get("id");

Promise.all([
  fetch("data/EnemySpawn.json").then(r => r.json()),
  loadStageNames(),
  loadEnemyNames()
]).then(([enemyData, stageNames, enemyNames]) => {

  const { enemies } = parseDDON(enemyData);

  const spawns = enemies.filter(e =>
    String(e.StageId) === String(stageId)
  );

  if (!spawns.length) {
    document.getElementById("content").innerHTML =
      `<h1>Stage not found</h1>`;
    return;
  }

  const stage = stageNames[stageId];
  const stageName = stage?.en || `Stage ${stageId}`;
  const stageJP = stage?.jp || "";

  const enemiesInStage = {};
  spawns.forEach(e => {
    enemiesInStage[e.EnemyId] = true;
  });

  document.getElementById("content").innerHTML = `
    <h1>${stageName}</h1>
    <p>${stageJP}</p>
    <p><b>Stage ID:</b> ${stageId}</p>

    <h2>Enemies</h2>
    <ul>
      ${Object.keys(enemiesInStage).map(id => `
        <li>
          <a href="monster.html?id=${id}">
            ${enemyNames[id] || `Enemy ${id}`}
          </a>
        </li>
      `).join("")}
    </ul>
  `;
});
</script>

</body>
</html>
