<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DDON Ultra Wiki</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    background:#0f1117;
    color:#e6e6e6;
}

header{
    background:#151823;
    padding:20px;
    border-bottom:2px solid #c8a75d;
}

h1{
    margin:0;
    color:#c8a75d;
}

.container{
    padding:30px;
    max-width:1400px;
    margin:auto;
}

.search{
    margin-bottom:30px;
}

input{
    width:100%;
    padding:12px;
    background:#1b1f2b;
    border:1px solid #333;
    color:white;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
    gap:15px;
}

.card{
    background:#1b1f2b;
    padding:15px;
    border-radius:6px;
    cursor:pointer;
    transition:0.2s;
    border:1px solid #222;
}

.card:hover{
    transform:translateY(-4px);
    border-color:#c8a75d;
}

.detail{
    margin-top:40px;
    background:#1b1f2b;
    padding:25px;
    border-radius:8px;
}
</style>
</head>

<body>

<header>
<h1>DDON Ultra Wiki</h1>
</header>

<div class="container">

<div class="search">
<input type="text" id="search" placeholder="Search...">
</div>

<div class="grid" id="grid"></div>

<div class="detail" id="detail" style="display:none;"></div>

</div>

<script>

const grid = document.getElementById("grid");
const detail = document.getElementById("detail");
const searchInput = document.getElementById("search");

let monsters = {};
let stages = {};
let items = [];

async function loadData(){

    const enemyNames = await fetch("datas/enemy-names.json").then(r=>r.json());
    const stageNames = await fetch("datas/stage-names.json").then(r=>r.json());
    const itemCSV = await fetch("datas/itemlist.csv").then(r=>r.text());

    monsters = enemyNames;
    stages = stageNames;

    // parse CSV
    const rows = itemCSV.split("\n");
    items = rows.map(r=>r.split(","));
}

function renderMonsters(){

    grid.innerHTML = "";
    Object.entries(monsters).forEach(([id,name])=>{
        createCard("monster", id, name);
    });
}

function renderStages(){

    grid.innerHTML = "";
    Object.entries(stages).forEach(([id,data])=>{
        createCard("stage", id, data.en);
    });
}

function renderItems(){

    grid.innerHTML = "";
    items.forEach(row=>{
        if(row[1]){
            createCard("item", row[0], row[1]);
        }
    });
}

function createCard(type,id,name){

    const card = document.createElement("div");
    card.className="card";
    card.innerHTML = `<strong>${name}</strong><br>ID: ${id}`;

    card.onclick=()=>{
        showDetail(type,id,name);
    };

    grid.appendChild(card);
}

function showDetail(type,id,name){

    detail.style.display="block";
    detail.innerHTML = `
        <h2>${name}</h2>
        <p><strong>Type:</strong> ${type}</p>
        <p><strong>ID:</strong> ${id}</p>
    `;

    window.history.pushState({}, "", `?type=${type}&id=${id}`);
}

function searchFilter(){

    const term = searchInput.value.toLowerCase();
    document.querySelectorAll(".card").forEach(card=>{
        card.style.display = card.innerText.toLowerCase().includes(term)
            ? "block" : "none";
    });
}

searchInput.addEventListener("input", searchFilter);

loadData().then(()=>{
    renderMonsters();
});

</script>

</body>
</html>
