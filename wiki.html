<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DDON Ultra Wiki</title>
<style>
body{
    margin:0;
    background:#0f1117;
    color:#e6e6e6;
    font-family:Arial, sans-serif;
}
header{
    padding:20px;
    background:#161b22;
    text-align:center;
    font-size:28px;
    font-weight:bold;
    border-bottom:2px solid #c8a75d;
}
.tabs{
    display:flex;
    justify-content:center;
    gap:20px;
    margin:20px 0;
}
.tab{
    padding:10px 20px;
    background:#1c2128;
    cursor:pointer;
    border:1px solid #30363d;
}
.tab.active{
    background:#c8a75d;
    color:#000;
}
#search{
    display:block;
    margin:20px auto;
    padding:10px;
    width:300px;
    background:#161b22;
    border:1px solid #30363d;
    color:white;
}
.content{
    max-width:1000px;
    margin:0 auto 50px auto;
}
.card{
    background:#161b22;
    padding:15px;
    margin:10px 0;
    border:1px solid #30363d;
}
</style>
</head>

<body>

<header>DDON Ultra Wiki</header>

<div class="tabs">
    <div class="tab active" data-tab="monsters">Monsters</div>
    <div class="tab" data-tab="items">Items</div>
    <div class="tab" data-tab="stages">Stages</div>
</div>

<input type="text" id="search" placeholder="Search...">

<div class="content" id="content"></div>

<script>

let currentTab = "monsters"
let monsters = {}
let stages = {}
let items = []

async function loadData(){

    const enemyNames = await fetch("datas/enemy-names.json").then(r=>r.json())
    const stageNames = await fetch("datas/stage-names.json").then(r=>r.json())
    const itemCSV = await fetch("datas/itemlist.csv").then(r=>r.text())

    monsters = enemyNames
    stages = stageNames

    items = parseCSV(itemCSV)

    render()
}

function parseCSV(text){
    const rows = text.split("\n")
    return rows.map(r => r.split(","))
}

function render(){

    const content = document.getElementById("content")
    const searchValue = document.getElementById("search").value.toLowerCase()
    content.innerHTML = ""

    if(currentTab === "monsters"){

        Object.entries(monsters).forEach(([id,name])=>{
            if(!name.toLowerCase().includes(searchValue)) return
            content.innerHTML += `
                <div class="card">
                    <b>${name}</b><br>
                    ID: ${id}
                </div>
            `
        })
    }

    if(currentTab === "stages"){

        Object.entries(stages).forEach(([id,data])=>{
            const name = data.en
            if(!name.toLowerCase().includes(searchValue)) return
            content.innerHTML += `
                <div class="card">
                    <b>${name}</b><br>
                    Stage ID: ${id}
                </div>
            `
        })
    }

    if(currentTab === "items"){

        items.forEach(row=>{
            if(!row[0]) return
            if(!row.join(" ").toLowerCase().includes(searchValue)) return
            content.innerHTML += `
                <div class="card">
                    ${row.join(" | ")}
                </div>
            `
        })
    }
}

document.querySelectorAll(".tab").forEach(tab=>{
    tab.addEventListener("click",()=>{
        document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"))
        tab.classList.add("active")
        currentTab = tab.dataset.tab
        render()
    })
})

document.getElementById("search").addEventListener("input",render)

loadData()

</script>

</body>
</html>
