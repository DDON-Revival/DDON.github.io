<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DDON Ultra Wiki</title>
<style>

body{
    margin:0;
    background:#0b0f18;
    font-family:Arial;
    color:white;
}

header{
    padding:20px;
    font-size:28px;
    font-weight:bold;
    background:#121a2b;
    border-bottom:2px solid #c8a75d;
}

.tabs{
    display:flex;
    gap:20px;
    padding:15px;
    background:#0f1625;
}

.tab{
    cursor:pointer;
    padding:8px 15px;
    border:1px solid #c8a75d;
}

.tab:hover{
    background:#c8a75d;
    color:black;
}

.section{
    padding:30px;
}

input{
    width:100%;
    padding:10px;
    background:#1a2338;
    border:1px solid #c8a75d;
    color:white;
    margin-bottom:20px;
}

.card{
    background:#1a2338;
    padding:20px;
    margin-bottom:15px;
    border-radius:6px;
}

.spawn{
    margin-top:10px;
    font-size:14px;
    opacity:0.9;
}

</style>
</head>
<body>

<header>DDON Ultra Wiki</header>

<div class="tabs">
    <div class="tab" onclick="showTab('monsters')">Monsters</div>
    <div class="tab" onclick="showTab('items')">Items</div>
    <div class="tab" onclick="showTab('stages')">Stages</div>
</div>

<div id="content" class="section"></div>

<script>

let enemyNames = {};
let enemySpawn = {};
let stageNames = {};
let items = [];

async function loadData(){

    enemyNames = await fetch("datas/enemy-names.json").then(r=>r.json());
    enemySpawn = await fetch("datas/EnemySpawn.json").then(r=>r.json());
    stageNames = await fetch("datas/stage-names.json").then(r=>r.json());

    const itemText = await fetch("datas/itemlist.csv").then(r=>r.text());
    items = itemText.split("\n").slice(1).map(row=>{
        const cols = row.split(",");
        return {
            id: cols[0],
            name: cols[1]
        }
    });

    showTab("monsters");
}

function showTab(tab){

    if(tab==="monsters") renderMonsters();
    if(tab==="items") renderItems();
    if(tab==="stages") renderStages();
}

function renderMonsters(){

    let html = `
        <input placeholder="Search monster..." oninput="filterMonsters(this.value)">
        <div id="monsterList"></div>
    `;

    document.getElementById("content").innerHTML = html;
    filterMonsters("");
}

function filterMonsters(search){

    const container = document.getElementById("monsterList");
    container.innerHTML="";

    Object.entries(enemyNames).forEach(([id,name])=>{

        if(!name.toLowerCase().includes(search.toLowerCase())) return;

        let spawnData = "";
        if(enemySpawn[id]){
            spawnData = enemySpawn[id].map(sp=>{
                const stage = stageNames[sp.stageId]?.en || "Unknown Stage";
                return `<div>Stage: ${stage} (Lv.${sp.level})</div>`;
            }).join("");
        }

        container.innerHTML += `
            <div class="card">
                <strong>${name}</strong><br>
                ID: ${id}
                <div class="spawn">${spawnData || "No spawn data"}</div>
            </div>
        `;
    });
}

function renderItems(){

    let html = `
        <input placeholder="Search item..." oninput="filterItems(this.value)">
        <div id="itemList"></div>
    `;

    document.getElementById("content").innerHTML = html;
    filterItems("");
}

function filterItems(search){

    const container = document.getElementById("itemList");
    container.innerHTML="";

    items.forEach(item=>{

        if(!item.name) return;
        if(!item.name.toLowerCase().includes(search.toLowerCase())) return;

        container.innerHTML += `
            <div class="card">
                <strong>${item.name}</strong><br>
                ID: ${item.id}
            </div>
        `;
    });
}

function renderStages(){

    let html = `
        <input placeholder="Search stage..." oninput="filterStages(this.value)">
        <div id="stageList"></div>
    `;

    document.getElementById("content").innerHTML = html;
    filterStages("");
}

function filterStages(search){

    const container = document.getElementById("stageList");
    container.innerHTML="";

    Object.entries(stageNames).forEach(([id,data])=>{

        if(!data.en.toLowerCase().includes(search.toLowerCase())) return;

        container.innerHTML += `
            <div class="card">
                <strong>${data.en}</strong><br>
                ID: ${id}
            </div>
        `;
    });
}

loadData();

</script>

</body>
</html>
