<script>
const DATA_BASE = "https://raw.githubusercontent.com/DDON-Revival/DDON.github.io/main/datas/";

let enemySpawn = null;
let enemyNames = {};
let stageNames = {};
let itemNames = {};
let dropTables = {};

async function loadData() {
    const [spawnRes, enemyRes, stageRes, itemRes] = await Promise.all([
        fetch(DATA_BASE + "EnemySpawn.json"),
        fetch(DATA_BASE + "enemy-names.json"),
        fetch(DATA_BASE + "stage-names.json"),
        fetch(DATA_BASE + "item_name.toml")
    ]);

    enemySpawn = await spawnRes.json();
    enemyNames = await enemyRes.json();
    stageNames = await stageRes.json();

    const tomlText = await itemRes.text();
    parseTomlItems(tomlText);

    buildDropTableMap();
    console.log("ULTRA WIKI GOD MODE LOADED");
}

function parseTomlItems(text) {
    const lines = text.split("\n");
    lines.forEach(line => {
        const match = line.match(/^(\d+)\s*=\s*"(.*)"/);
        if (match) {
            itemNames[parseInt(match[1])] = match[2];
        }
    });
}

function buildDropTableMap() {
    enemySpawn.dropsTables.forEach(dt => {
        dropTables[dt.id] = dt;
    });
}

function getEnemyName(id) {
    return enemyNames[id] || id;
}

function getStageName(id) {
    return stageNames[id]?.en || id;
}

function getItemName(id) {
    return itemNames[id] || id;
}

function getMonsterData(enemyIdHex) {
    return enemySpawn.enemies.filter(e => e[5] === enemyIdHex);
}

function getDropData(dropTableId) {
    return dropTables[dropTableId];
}

loadData();
</script>
